{% extends 'base.html' %}
{% load static %}

{% block title %}Seleccionar CV - AI-Need-Job{% endblock %}

{% block breadcrumb %}
<nav style="margin-bottom: 1rem;">
    <a href="{% url 'home' %}" style="color: var(--text-secondary); text-decoration: none;">
        <i class="fas fa-home"></i> Inicio
    </a>
    <span style="margin: 0 0.5rem; color: var(--text-secondary);">/</span>
    <a href="{% url 'feed' %}" style="color: var(--text-secondary); text-decoration: none;">
        Vacantes
    </a>
    <span style="margin: 0 0.5rem; color: var(--text-secondary);">/</span>
    <span style="color: var(--text-primary); font-weight: 500;">Aplicar</span>
</nav>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <i class="fas fa-paper-plane"></i> Aplicar a Vacante
    </h1>
    <p class="page-subtitle">
        Selecciona el CV que mejor se adapte a esta oportunidad
    </p>
</div>

<div class="card mb-3">
    <div class="card-header">
        <h3 class="card-title">{{ vacancy.title }}</h3>
    </div>
    <div class="card-content">
        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
            {{ vacancy.description|truncatewords:30 }}
        </p>
        {% if vacancy.requirements %}
            <div>
                <h4 style="font-size: 0.9rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">
                    <i class="fas fa-list-check"></i> Requisitos:
                </h4>
                <p style="font-size: 0.9rem; color: var(--text-secondary);">
                    {{ vacancy.requirements|truncatewords:20 }}
                </p>
            </div>
        {% endif %}
    </div>
</div>

<div class="flex justify-center">
    <div class="card" style="max-width: 600px; width: 100%;">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-file-alt"></i> Seleccionar CV
            </h3>
        </div>
        <div class="card-content">
            <form method="post">
                {% csrf_token %}
                
                {% if resumes %}
                    <div class="list">
                        {% for resume in resumes %}
                            <div class="list-item" style="cursor: pointer;" onclick="document.getElementById('cv{{ resume.id }}').checked = true;">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <input type="radio" name="resume_id" id="cv{{ resume.id }}" value="{{ resume.id }}" required 
                                           style="margin: 0; transform: scale(1.2);">
                                    <div style="flex: 1;">
                                        <h4 style="margin-bottom: 0.5rem; color: var(--text-primary);">
                                            {{ resume.name }}
                                        </h4>
                                        <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">
                                            <i class="fas fa-calendar"></i> Subido: {{ resume.uploaded_at|date:"d/m/Y H:i" }}
                                        </p>
                                        {% if resume.vacancy_text %}
                                            <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0.5rem 0 0 0;">
                                                <i class="fas fa-briefcase"></i> Optimizado para: {{ resume.vacancy_text|truncatewords:10 }}
                                            </p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-paper-plane"></i> Aplicar con CV Seleccionado
                        </button>
                        <a href="{% url 'feed' %}" class="btn btn-outline btn-lg">
                            <i class="fas fa-times"></i> Cancelar
                        </a>
                    </div>
                {% else %}
                    <div class="text-center">
                        <i class="fas fa-file-alt" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">No tienes CVs subidos</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                            Necesitas subir al menos un CV para poder aplicar a vacantes.
                        </p>
                        <a href="{% url 'upload_cv' %}" class="btn btn-primary">
                            <i class="fas fa-upload"></i> Subir CV
                        </a>
                    </div>
                {% endif %}
            </form>
        </div>
    </div>
</div>
{% endblock %}